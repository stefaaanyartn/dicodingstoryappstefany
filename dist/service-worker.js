const CACHE_NAME="story-app-v1",IMAGE_CACHE="story-images",STATIC_ASSETS=["/","/index.html","/bundle.js","/styles.css","/icons/web-app-manifest-192x192.png","/icons/web-app-manifest-512x512.png","/icons/favicon-96x96.png"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(STATIC_ASSETS)))),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME&&e!==IMAGE_CACHE)return caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{const{request:t}=e,s=t.url;s.includes("/sockjs-node")||t.headers.get("accept")?.includes("text/event-stream")||s.includes("favicon")||("image"===t.destination&&s.includes("https://story-api.dicoding.dev/images/stories/")?e.respondWith(caches.open(IMAGE_CACHE).then((async e=>{const n=await e.match(t);if(n)return n;try{const s=await fetch(t);return s.ok&&e.put(t,s.clone()),s}catch(e){return console.warn("Image fetch failed:",s,e),new Response("",{status:503,statusText:"Image unavailable"})}}))):STATIC_ASSETS.includes(new URL(s).pathname)?e.respondWith(caches.match(t).then((e=>e||fetch(t)))):e.respondWith(fetch(t).catch((()=>caches.match(t)))))}));