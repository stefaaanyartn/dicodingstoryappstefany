import IndexedDB from"../utils/indexedDB.js";class FavoriteView{constructor(){this.root=document.getElementById("main-content")}async show(){this.root.innerHTML='\n      <h2>Daftar Favorit</h2>\n      <button id="clear-all">Hapus Semua</button>\n      <div id="favorites-list"></div>\n    ';const t=await IndexedDB.getFavoriteStoriesFromDb(),e=document.getElementById("favorites-list"),a=document.getElementById("clear-all");0!==t.length?(t.forEach(((t,a)=>{const n=document.createElement("div");n.classList.add("story-card");const i=`fav-map-${a}`;n.innerHTML=`\n        <img src="${t.imageBase64}" alt="${t.description||""}" />\n        <h3>${t.name}</h3>\n        <p>${t.description}</p>\n        ${t.lat&&t.lon?`<div id="${i}" class="story-map" style="height: 200px; margin-top: 10px;"></div>`:""}\n        <button class="delete-btn" data-id="${t.id}">Hapus</button>\n      `,e.appendChild(n),t.lat&&t.lon&&requestAnimationFrame((()=>{setTimeout((()=>{if(!document.getElementById(i))return;const e=L.map(i).setView([t.lat,t.lon],13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}).addTo(e),L.marker([t.lat,t.lon]).addTo(e).bindPopup(`<b>${t.name}</b><br>${t.description}`).openPopup(),setTimeout((()=>e.invalidateSize()),100)}),50)}))})),e.addEventListener("click",(async t=>{if(t.target.classList.contains("delete-btn")){const e=t.target.dataset.id;await IndexedDB.removeFavoriteStoryFromDb(e),this.show()}})),a.addEventListener("click",(async()=>{confirm("Yakin ingin menghapus semua data favorit?")&&(await IndexedDB.clearAllFavoriteStories(),this.show())}))):e.innerHTML="<p>Tidak ada data favorit yang tersimpan.</p>"}}export default FavoriteView;